<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Axial Character Sheet</title>
<style>
:root{
  --bg:#1c1d21;--fg:#e6e7eb;--accent:#3a86ff;--border:#44454b;
  --pad:0.4rem;--gap:0.6rem;--radius:6px;--font:system-ui,Segoe UI,Roboto,sans-serif;
}
@media (prefers-color-scheme:light){
  :root{--bg:#fdfdfd;--fg:#111;--border:#ccc;}
}
html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:var(--font);}
h2{margin:var(--gap) 0 0.3rem;font-size:1.1rem;border-bottom:1px solid var(--border);}
section{margin-bottom:1.2rem;}
form{max-width:960px;margin:auto;padding:1rem;display:flex;flex-direction:column;gap:var(--gap);}
.grid2{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:var(--gap);}
input,select,textarea{width:100%;box-sizing:border-box;padding:var(--pad);border:1px solid var(--border);border-radius:var(--radius);background:transparent;color:inherit;}
textarea{min-height:4rem;resize:vertical;}
button{cursor:pointer;background:var(--accent);color:#fff;border:none;border-radius:var(--radius);padding:var(--pad) 0.8rem;font-weight:600;}
button.small{padding:0 var(--pad);font-size:0.9rem;}
fieldset{border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad);margin:0;}
.row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:var(--gap);margin-bottom:var(--gap);}
.row > *:first-child{grid-column:1 / span 1;}
.template{display:none;}
</style>
</head>
<body>
<form id="sheet" autocomplete="off">
  <!-- Identity -->
  <section>
    <h2>Identity</h2>
    <div class="grid2">
      <input id="name" placeholder="Name">
      <input id="concept" placeholder="Concept">
      <input id="age" placeholder="Age" type="number" min="0">
      <input id="player" placeholder="Player">
      <input id="xp" placeholder="Experience" type="number" min="0">
      <textarea id="bonds" placeholder="Bonds"></textarea>
    </div>
  </section>

  <!-- Core Skills -->
  <section>
    <h2>Core Skills (die size)</h2>
    <div class="grid2" id="skills"></div>
  </section>

  <!-- Special Statistics -->
  <section>
    <h2>Statistics</h2>
    <div class="grid2">
      <input id="strain" type="number" placeholder="Strain">
      <input id="surges" type="number" placeholder="Surges">
      <input id="supplies" type="number" placeholder="Supplies">
      <input id="wealth" type="number" placeholder="Wealth">
      <input id="healthCurrent" type="number" placeholder="Health Current">
      <input id="healthMax" type="number" placeholder="Health Max">
      <input id="encCurrent" type="number" placeholder="Encumbrance Current">
      <input id="encMax" type="number" placeholder="Encumbrance Max">
    </div>
  </section>

  <!-- Conditions -->
  <section>
    <h2>Conditions</h2>
    <textarea id="conditions" placeholder="Comma-separated conditions"></textarea>
  </section>

  <!-- Dynamic Lists -->
  <section>
    <h2>Talents</h2>
    <fieldset id="talents"></fieldset>
    <button type="button" onclick="addRow('talent')">Add Talent</button>
  </section>

  <section>
    <h2>Powers</h2>
    <fieldset id="powers"></fieldset>
    <button type="button" onclick="addRow('power')">Add Power</button>
  </section>

  <section>
    <h2>Wounds</h2>
    <fieldset id="wounds"></fieldset>
    <button type="button" onclick="addRow('wound')">Add Wound</button>
  </section>

  <section>
    <h2>Inventory</h2>
    <fieldset id="inventory"></fieldset>
    <button type="button" onclick="addRow('item')">Add Item</button>
  </section>

  <!-- Notes -->
  <section>
    <h2>Miscellaneous Notes</h2>
    <textarea id="notes"></textarea>
  </section>

  <!-- Controls -->
  <section class="grid2">
    <button type="button" onclick="saveJSON()">Save to JSON</button>
    <label style="display:flex;align-items:center;gap:var(--gap);">
      <button type="button">Load JSON</button>
      <input type="file" accept="application/json" style="display:none" onchange="loadJSON(event)">
    </label>
  </section>
</form>

<!-- Templates -->
<template id="talent-template">
  <div class="row">
    <input placeholder="Talent Name" class="name">
    <select class="die">
      <option>d4</option><option>d6</option><option>d8</option><option>d10</option><option>d12</option>
    </select>
    <button type="button" class="small" onclick="removeRow(this)">✕</button>
  </div>
</template>

<template id="power-template">
  <div class="row">
    <input placeholder="Name | Type | Cooldown | Speed" class="meta">
    <textarea placeholder="Description" class="desc"></textarea>
    <button type="button" class="small" onclick="removeRow(this)">✕</button>
  </div>
</template>

<template id="wound-template">
  <div class="row">
    <input placeholder="Roll" class="roll" type="number">
    <input placeholder="Name" class="name">
    <input placeholder="Effect" class="effect">
    <input placeholder="HP Penalty" class="penalty" type="number">
    <button type="button" class="small" onclick="removeRow(this)">✕</button>
  </div>
</template>

<template id="item-template">
  <div class="row">
    <input placeholder="Object Line (pipe-delimited)" class="line">
    <button type="button" class="small" onclick="removeRow(this)">✕</button>
  </div>
</template>

<script>
const skillList=["Agility","Artifice","Charm","Fortitude","Intellect","Might","Presence","Precision","Resolve","Sense"];
const skillsDiv=document.getElementById("skills");
skillList.forEach(s=>{
  const label=document.createElement("label");
  label.textContent=s;
  label.style.display="contents";
  const sel=document.createElement("select");
  sel.id=s.toLowerCase();
  ["d4","d6","d8","d10","d12"].forEach(d=>{
    const o=document.createElement("option");o.textContent=d;sel.appendChild(o);
  });
  label.appendChild(sel);
  skillsDiv.appendChild(label);
});
function addRow(kind){
  const map={talent:"talents",power:"powers",wound:"wounds",item:"inventory"};
  const tpl=document.getElementById(`${kind}-template`).content.cloneNode(true);
  document.getElementById(map[kind]).appendChild(tpl);
}
function removeRow(btn){btn.parentElement.remove();}
function collectSection(container,mapper){
  return [...container.children].map(mapper);
}
function saveJSON(){
  const data={
    identity:{
      name:val("name"),concept:val("concept"),age:num("age"),player:val("player"),xp:num("xp"),bonds:val("bonds")
    },
    skills:skillList.reduce((o,s)=>(o[s]=val(s.toLowerCase()),o),{}),
    stats:{
      strain:num("strain"),surges:num("surges"),supplies:num("supplies"),wealth:num("wealth"),
      health:[num("healthCurrent"),num("healthMax")],
      encumbrance:[num("encCurrent"),num("encMax")]
    },
    conditions:val("conditions"),
    talents:collectSection(talents,r=>({name:r.querySelector(".name").value,die:r.querySelector(".die").value})),
    powers:collectSection(powers,r=>({meta:r.querySelector(".meta").value,desc:r.querySelector(".desc").value})),
    wounds:collectSection(wounds,r=>({
      roll:+r.querySelector(".roll").value,name:r.querySelector(".name").value,
      effect:r.querySelector(".effect").value,penalty:+r.querySelector(".penalty").value
    })),
    inventory:collectSection(inventory,r=>r.querySelector(".line").value),
    notes:val("notes")
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="axial_character.json";a.click();
}
function loadJSON(e){
  const file=e.target.files[0];if(!file)return;
  const fr=new FileReader();
  fr.onload=()=>{try{populate(JSON.parse(fr.result));}catch(err){alert("Invalid JSON");}};
  fr.readAsText(file);
}
function populate(d){
  setVal("name",d.identity.name);setVal("concept",d.identity.concept);
  setVal("age",d.identity.age);setVal("player",d.identity.player);
  setVal("xp",d.identity.xp);setVal("bonds",d.identity.bonds);
  skillList.forEach(s=>setVal(s.toLowerCase(),d.skills[s]));
  setVal("strain",d.stats.strain);setVal("surges",d.stats.surges);
  setVal("supplies",d.stats.supplies);setVal("wealth",d.stats.wealth);
  setVal("healthCurrent",d.stats.health[0]);setVal("healthMax",d.stats.health[1]);
  setVal("encCurrent",d.stats.encumbrance[0]);setVal("encMax",d.stats.encumbrance[1]);
  setVal("conditions",d.conditions);
  talents.innerHTML="";d.talents.forEach(t=>{addRow('talent');const last=talents.lastElementChild;last.querySelector(".name").value=t.name;last.querySelector(".die").value=t.die;});
  powers.innerHTML="";d.powers.forEach(p=>{addRow('power');const last=powers.lastElementChild;last.querySelector(".meta").value=p.meta;last.querySelector(".desc").value=p.desc;});
  wounds.innerHTML="";d.wounds.forEach(w=>{addRow('wound');const last=wounds.lastElementChild;last.querySelector(".roll").value=w.roll;last.querySelector(".name").value=w.name;last.querySelector(".effect").value=w.effect;last.querySelector(".penalty").value=w.penalty;});
  inventory.innerHTML="";d.inventory.forEach(i=>{addRow('item');inventory.lastElementChild.querySelector(".line").value=i;});
  setVal("notes",d.notes);
}
const val=id=>document.getElementById(id).value;
const num=id=>+val(id)||0;
const setVal=(id,v)=>{if(document.getElementById(id))document.getElementById(id).value=v??"";}
</script>
</body>
</html>

