<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Emerson Neher - Portfolio</title>

  <!-- SEO Meta Tags -->
  <meta name="description"
    content="Emerson Neher - Financial Technology & Information Systems student at WPI. Security enthusiast, game designer, and writer." />
  <meta name="keywords"
    content="Emerson Neher, WPI, Financial Technology, Information Systems, Security, Game Design, TTRPG" />

  <!-- Fonts -->

  <div class="main-container">

    <!-- Left Column -->
    <div class="left-column">
      <!-- Substack Blog Feed -->
      <div class="substack-card">
        <h3>Hopeless Poetic</h3>
        <p class="rss-subtitle">Latest from my Substack</p>
        <div id="substackStatus" class="rss-status">Loading posts…</div>
        <ul id="substackFeed" class="substack-list"></ul>
        <span class="rss-footnote">
          <a href="https://emersonneher.substack.com" target="_blank">Visit Hopeless Poetic →</a>
        </span>
      </div>

      <!-- Markov Generator Card -->
      <div class="markov-card">
        <h3>Emerson's Wisdom</h3>
        <div id="markovQuote">Click below to generate...</div>
        <button id="regenerateBtn" class="card-btn">Bestow Wisdom</button>
      </div>
    </div>

    <!-- Center Card -->
    <div class="center-card">
      <div class="card-buttons">
        <button id="themeToggleBtn" class="toggle-theme-btn">Toggle Theme</button>
        <a href="axial/axialcharactersheet.html" class="card-btn">Axial TTRPG</a>
        <a href="https://emersonneher.substack.com" target="_blank" class="card-btn">Hopeless Poetic</a>
        <button id="miscBtn" class="card-btn">Miscellaneous</button>
      </div>

      <div class="card-image">
        <img src="assets/images/sittingimage.jpg" alt="Emerson Neher" />
      </div>

      <div class="contact-card">
        <h1>Emerson Neher</h1>
        <h3>they/them/theirs</h3>
        <p>Email: <a href="mailto:emersonneher@gmail.com">emersonneher@gmail.com</a></p>
        <p>Worcester, MA & Evergreen, CO</p>
        <p>
          Worcester Polytechnic Institute | Class of 2028<br />
          Financial Technology Major | Information Systems Major
        </p>
        <p class="links">
          <a href="https://www.linkedin.com/in/emerson-neher-184274346" target="_blank">LinkedIn</a> |
          <a href="https://www.instagram.com/emerson.neher/" target="_blank">Instagram</a> |
          <a href="https://discord.com/users/noblejace" target="_blank">Discord</a>
        </p>
        <p class="bio">
          Passionate about security, technology, and system design. I'm a writer, game designer,
          and storyteller who loves poetry, the mechanics of RPGs,
          and the art of photography. I am also deeply fascinated by security and the systems that minimize risk in our
          world. If you can't break it, it can't be fixed.
        </p>
      </div>

      <div class="spotify-container">
        <div class="spotify-title">Currently Listening</div>
        <iframe src="https://open.spotify.com/embed/playlist/0FdmEAvUL4hFCzBDev8n6J?utm_source=generator&theme=1"
          width="100%" height="180" frameborder="0"
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
        </iframe>
      </div>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <!-- RSS / Interests Feed Card -->
      <div class="rss-card">
        <h3>Interest Feed</h3>
        <p class="rss-subtitle">Fintech, security, RPGs, poetry, and more.</p>
        <div id="rssStatus" class="rss-status">Loading latest posts…</div>
        <ul id="rssFeed" class="rss-list"></ul>
        <span class="rss-footnote">
          All in good fun.
        </span>
      </div>
    </div>
  </div>

  <!-- Floating Image Tiles -->
  <div class="tiles-container"></div>

  <!-- Miscellaneous Modal -->
  <div id="miscModal" class="modal hidden">
    <div class="modal-content">
      <button id="closeModal" class="close-btn" aria-label="Close">&times;</button>
      <h2>Miscellaneous Projects</h2>
      <p>Explore extra snippets, downloads, and fun experiments.</p>
      <ul style="list-style:none;line-height:1.8;padding:0;margin-top:1em;">
        <li><a href="resume.pdf" download>Download my resume</a></li>
        <li><a href="Omega/index.html" target="_blank">Portfolio Optimizer (Omega API)</a></li>
        <li><a href="https://open.spotify.com/playlist/3vDF8HiTd7JqePb8OrA4vA?si=59d7ce28997841d1"
            target="_blank">Favorite Playlist</a></li>
        <li><a href="https://hopelesspoetic.com/weakestlink.html" target="_blank">Weakest&nbsp;Link (MKT4030)</a></li>
        <li><a href="systemgen.html" target="_blank">Astral Axial (Legacy)</a></li>
      </ul>
    </div>
  </div>

  <script>
    // ============================================
    // CUSTOM MARKOV CHAIN IMPLEMENTATION
    // ============================================
    class SimpleMarkov {
      constructor(order = 2) {
        this.order = order;
        this.chain = {};
      }

      train(text) {
        const words = text.split(/\s+/).filter(w => w.length > 0);

        for (let i = 0; i < words.length - this.order; i++) {
          const key = words.slice(i, i + this.order).join(' ');
          const next = words[i + this.order];

          if (!this.chain[key]) {
            this.chain[key] = [];
          }
          this.chain[key].push(next);
        }
      }

      generate(minLength = 5, maxLength = 15) {
        const keys = Object.keys(this.chain);
        if (keys.length === 0) return "No wisdom available yet...";

        let key = keys[Math.floor(Math.random() * keys.length)];
        let result = key.split(' ');

        while (result.length < maxLength) {
          const possibilities = this.chain[key];
          if (!possibilities || possibilities.length === 0) break;

          const next = possibilities[Math.floor(Math.random() * possibilities.length)];
          result.push(next);

          // Update key for next iteration
          const words = result.slice(-this.order);
          key = words.join(' ');
        }

        // Capitalize first letter
        let sentence = result.join(' ');
        sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1);

        // Add period if not present
        if (!/[.!?]$/.test(sentence)) {
          sentence += '.';
        }

        return sentence;
      }
    }

    // Initialize and train Markov chain
    const markov = new SimpleMarkov(2);

    fetch('assets/data/emersonmarkovchain.txt')
      .then(r => r.text())
      .then(raw => {
        // Clean and prepare text
        const cleanText = raw
          .replace(/<[^>]+>/g, '')
          .replace(/[^\w\s.!?]/g, '')
          .toLowerCase();

        markov.train(cleanText);

        // Wire up UI
        const out = document.getElementById('markovQuote');
        const btn = document.getElementById('regenerateBtn');

        btn.onclick = () => {
          out.textContent = markov.generate(5, 15);
        };

        // Generate initial quote
        out.textContent = markov.generate(5, 15);
      })
      .catch(err => {
        console.error('Markov error:', err);
        document.getElementById('markovQuote').textContent = 'Failed to load wisdom corpus.';
      });

    // ============================================
    // THEME TOGGLE
    // ============================================
    document.getElementById('themeToggleBtn')
      .addEventListener('click', () => document.body.classList.toggle('light-mode'));

    // ============================================
    // FLOATING TILES
    // ============================================
    const tilePaths = Array.from({ length: 34 }, (_, i) => `assets/images/${i + 4}.jpg`);
    const tilesContainer = document.querySelector('.tiles-container');
    const tileData = [];
    let tileLoaded = 0;

    tilePaths.forEach(src => {
      const img = new Image();
      img.src = src;
      img.onload = () => {
        tileData.push({ src, aspect: img.width / img.height || 1 });
        checkTiles();
      };
      img.onerror = checkTiles;
    });

    function checkTiles() {
      if (++tileLoaded === tilePaths.length) {
        spawnTile();
        setInterval(() => tilesContainer.children.length < 5 && spawnTile(), 2000);
      }
    }

    function spawnTile() {
      if (!tileData.length) return;
      const { src, aspect } = tileData[Math.random() * tileData.length | 0];
      const el = document.createElement('div'),
        w = 150 + Math.random() * 250,
        h = w / aspect;
      el.className = 'moving-tile';
      el.style.width = w + 'px';
      el.style.height = h + 'px';
      el.style.top = Math.random() * (window.innerHeight - h) + 'px';
      el.style.backgroundImage = `url('${src}')`;
      el.onanimationend = () => el.remove();
      tilesContainer.appendChild(el);
    }

    // ============================================
    // MODAL HANDLERS
    // ============================================
    const miscModal = document.getElementById('miscModal');
    document.getElementById('miscBtn').onclick = () => miscModal.classList.remove('hidden');
    document.getElementById('closeModal').onclick = () => miscModal.classList.add('hidden');
    miscModal.onclick = e => e.target === miscModal && miscModal.classList.add('hidden');

    // ============================================
    // SUBSTACK RSS FEED
    // ============================================
    const substackListEl = document.getElementById('substackFeed');
    const substackStatusEl = document.getElementById('substackStatus');

    async function loadSubstack() {
      try {
        substackStatusEl.textContent = 'Loading posts…';
        const response = await fetch(
          'https://api.rss2json.com/v1/api.json?rss_url=' +
          encodeURIComponent('https://emersonneher.substack.com/feed')
        );

        if (!response.ok) throw new Error('Failed to fetch');

        const data = await response.json();

        if (data && data.status === 'ok' && Array.isArray(data.items)) {
          substackStatusEl.textContent = 'Latest posts:';

          data.items.slice(0, 5).forEach(item => {
            const li = document.createElement('li');
            li.className = 'substack-item';

            const link = document.createElement('a');
            link.href = item.link;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            link.textContent = item.title;
            li.appendChild(link);

            const meta = document.createElement('div');
            meta.className = 'rss-item-meta';
            const date = new Date(item.pubDate);
            meta.textContent = date.toLocaleDateString(undefined, {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });
            li.appendChild(meta);

            // Add excerpt if available
            if (item.description) {
              const excerpt = document.createElement('div');
              excerpt.className = 'rss-item-excerpt';
              const tempDiv = document.createElement('div');
              tempDiv.innerHTML = item.description;
              const text = tempDiv.textContent || tempDiv.innerText || '';
              excerpt.textContent = text.substring(0, 150) + (text.length > 150 ? '...' : '');
              li.appendChild(excerpt);
            }

            substackListEl.appendChild(li);
          });
        } else {
          substackStatusEl.textContent = 'No posts available.';
        }
      } catch (e) {
        console.error('Substack error:', e);
        substackStatusEl.textContent = 'Failed to load posts.';
      }
    }

    // ============================================
    // ENHANCED RSS FEED
    // ============================================
    const rssListEl = document.getElementById('rssFeed');
    const rssStatusEl = document.getElementById('rssStatus');

    const rssFeeds = [
      {
        label: 'Fintech',
        url: 'https://www.finextra.com/rss/headlines.aspx?channel=fintech'
      },
      {
        label: 'InfoSec',
        url: 'https://feeds.feedburner.com/TheHackersNews'
      },
      {
        label: 'Cybersecurity',
        url: 'https://www.schneier.com/blog/atom.xml'
      },
      {
        label: 'RPG Design',
        url: 'https://www.enworld.org/ewr-porta/index.rss'
      },
      {
        label: 'Tech News',
        url: 'https://hnrss.org/frontpage'
      },
      {
        label: 'Game Dev',
        url: 'https://www.gamedeveloper.com/rss.xml'
      }
    ];

    const allItems = [];

    function formatDate(d) {
      const date = new Date(d);
      if (isNaN(date.getTime())) return '';
      return date.toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    function renderRSS() {
      rssListEl.innerHTML = '';
      if (!allItems.length) {
        rssStatusEl.textContent = 'No items loaded yet. Try refreshing in a bit.';
        return;
      }

      rssStatusEl.textContent = 'Latest from across my obsessions:';
      allItems
        .sort((a, b) => (b.pubDate || 0) - (a.pubDate || 0))
        .slice(0, 20)
        .forEach(item => {
          const li = document.createElement('li');
          li.className = 'rss-item';

          const link = document.createElement('a');
          link.href = item.link;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          link.textContent = item.title;
          li.appendChild(link);

          const meta = document.createElement('div');
          meta.className = 'rss-item-meta';
          meta.textContent = `${item.label} • ${formatDate(item.pubDateRaw)}`;
          li.appendChild(meta);

          // Add excerpt if available
          if (item.description) {
            const excerpt = document.createElement('div');
            excerpt.className = 'rss-item-excerpt';
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = item.description;
            const text = tempDiv.textContent || tempDiv.innerText || '';
            excerpt.textContent = text.substring(0, 120) + (text.length > 120 ? '...' : '');
            li.appendChild(excerpt);
          }

          rssListEl.appendChild(li);
        });
    }

    async function loadRSS() {
      rssStatusEl.textContent = 'Loading latest posts…';
      for (const feed of rssFeeds) {
        try {
          const response = await fetch(
            'https://api.rss2json.com/v1/api.json?rss_url=' +
            encodeURIComponent(feed.url)
          );
          if (!response.ok) continue;
          const data = await response.json();
          if (data && data.status === 'ok' && Array.isArray(data.items)) {
            data.items.slice(0, 5).forEach(item => {
              allItems.push({
                label: feed.label,
                title: item.title,
                link: item.link,
                description: item.description || item.content || '',
                pubDateRaw: item.pubDate,
                pubDate: new Date(item.pubDate).getTime() || 0
              });
            });
          }
        } catch (e) {
          console.error(`Error loading ${feed.label}:`, e);
        }
      }
      renderRSS();
    }

    // Initialize feeds
    loadSubstack();
    loadRSS();
  </script>
  </body>

</html>